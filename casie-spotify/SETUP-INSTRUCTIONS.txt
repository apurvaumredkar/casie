SpotiBot Final Setup Instructions
===================================

Your SpotiBot worker is deployed and ready!
Worker URL: https://monica-spotify.apoorv-umredkar.workers.dev

To complete the setup, you need to create a separate Discord application for SpotiBot:

STEP 1: Create Discord Application
------------------------------------
1. Go to: https://discord.com/developers/applications
2. Click "New Application"
3. Name it "SpotiBot" (or any name you prefer)
4. Click "Create"

STEP 2: Get Bot Credentials
-----------------------------
1. In your application, go to "Bot" section
2. Click "Add Bot" → Confirm
3. Click "Reset Token" → Copy the bot token
   Save this as: DISCORD_BOT_TOKEN

4. Go to "General Information" section
5. Copy the "Application ID"
   Save this as: APPLICATION_ID

6. Copy the "Public Key"
   Note: This should be DIFFERENT from Monica's public key
   Save this as: SPOTIBOT_DISCORD_PUBLIC_KEY

STEP 3: Update Secrets
-----------------------
Run these commands from the spotify-worker directory:

echo "YOUR_SPOTIBOT_PUBLIC_KEY" | npx wrangler secret put DISCORD_PUBLIC_KEY

(This will update the DISCORD_PUBLIC_KEY for SpotiBot specifically)

STEP 4: Set Interactions Endpoint
-----------------------------------
1. In Discord Developer Portal, go to "General Information"
2. Set "Interactions Endpoint URL" to:
   https://monica-spotify.apoorv-umredkar.workers.dev/interactions
3. Click "Save Changes"
4. Discord will verify the endpoint (you should see a green checkmark)

STEP 5: Register Commands
---------------------------
From the spotify-worker directory, run:

DISCORD_BOT_TOKEN="your_bot_token" APPLICATION_ID="your_app_id" node register-commands.js

Replace "your_bot_token" and "your_app_id" with the actual values from Step 2.

STEP 6: Invite Bot to Server
------------------------------
Generate invite URL (replace YOUR_APP_ID with your actual Application ID):

https://discord.com/api/oauth2/authorize?client_id=YOUR_APP_ID&scope=bot%20applications.commands&permissions=2048

Open this URL in your browser and invite the bot to your server.

STEP 7: Update Spotify Redirect URI
-------------------------------------
1. Go to: https://developer.spotify.com/dashboard
2. Click on your Spotify app (or create one if you haven't)
3. Go to "Settings"
4. Under "Redirect URIs", add:
   https://monica-spotify.apoorv-umredkar.workers.dev/oauth/callback
5. Click "Add" then "Save"

STEP 8: Test!
--------------
In Discord, try these commands:
1. /linkspotify - Should show authorization link
2. Click link, authorize Spotify
3. /nowplaying - Should show if account is linked
4. /play, /pause, /next - Should control Spotify (requires Premium)
5. /spotify query:play some jazz - AI-powered control!

TROUBLESHOOTING
---------------
If commands don't appear:
- Wait 5-10 minutes for Discord to propagate
- Refresh Discord (Ctrl+R)
- Re-run register-commands.js

If "Invalid request signature":
- Make sure DISCORD_PUBLIC_KEY for SpotiBot is set correctly
- It should be DIFFERENT from Monica's public key

If OAuth fails:
- Verify redirect URI matches exactly in Spotify settings
- Check that SPOTIFY_REDIRECT_URI secret is correct

View logs:
npx wrangler tail

ALL DONE!
---------
Once these steps are complete, SpotiBot will be fully operational!

Current Status:
✅ Worker deployed
✅ All Spotify secrets configured
✅ Health endpoint working
⏳ Awaiting Discord application setup
⏳ Awaiting command registration
⏳ Awaiting bot invitation
